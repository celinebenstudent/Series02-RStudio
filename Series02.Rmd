---
title: "Series02-RStudio\n"
author: "Denis MOTTET"
date: "`r format(Sys.time(), '%d %B, %Y, %H:%M')`"
output:
  html_document:
    df_print: paged
    code_folding: hide
    toc: false
    number_sections: true
---

# Correlations and linear regression
In this series of exercises, you will explore correlations and linear regression, using a dataset from a real experiment.

## The problem
You want to know if there is a relationship between the nonuse of the proximal part of the upper limb (PANU) and the nonuse of the shoulder (SANU) or the elbow (EENU).

## The data
As you will see, the data is far from perfect, but this is the reality of experimental data, especially in the case of clinical data.

- Download the file NonUse.csv from the course Moodle.

```{r load data}
nonuse <- read.csv("data/test_data/NonUse.csv", sep = ",", header = TRUE)
head(nonuse)
summary(nonuse)

```


-This file contains measures of upper extremity nonuse:


    PANU: Proximal Arm Non Use

    SANU: Shoulder Antepulsion Non Use

    EENU: Elbow Extension Non Use
    

- In your notebook, make a clear description of the experiment, the variables and the data. Do not forget to give the units of each variable, and the range of possible values.


| name | Description | unit |range
|--|---------|--|--
| PANU | Proximal Arm Non Use | % | 0-100
| SANU | Shoulder Antepulsion Non Use | %   | 0-100
| EENU | Elbow Extension Non Use | %  | 0-100 


## Corelation analysis
Below are some questions to guide your analysis.

- Is PANU correlated with SANU and/or EENU?

    We use a spearman correlation, because we do not have assumptions about the distribution of the data, and we do not assume a linear relationship between the variables.

```{r correlation-sanu}
cor.test(nonuse$PANU, nonuse$SANU, method = "spearman")
```


- Visualize the PANU-SANU relationship (and the PANU-EENU relationship)

```{r plot-panu}
library(ggplot2)
ggplot(nonuse, aes(x = PANU, y = SANU)) +
  geom_point() +
  xlim(-100, 100) +
  ylim(-100, 100) +
  labs(title = "PANU vs SANU", x = "PANU (%)", y = "SANU (%)") +
  theme_minimal()
       
```
       
       
- Perform a linear regression for PANU-SANU (and for PANU-EENU)

    We do not predict a linear relationship but we do it because it was asked. 

```{r plot-sanu}
library(ggplot2)
ggplot(nonuse, aes(x = SANU, y = PANU)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  # xlim(-100, 100) +
  # ylim(-100, 100) +
  labs(title = "SANU vs PANU", x = "PANU (%)", y = "SANU (%)") +
  theme_minimal()
       
       
```


- Give the regression equations: PANU = a * SANU + b and PANU = a * EENU + b

```{r lm-sanu}
lm_sanu <- lm(PANU ~ SANU, data=nonuse)
summary(lm_sanu)
coef(lm_sanu)
slope <- coef(lm_sanu)[2]
intercept <- coef(lm_sanu)[1]
cat("Regression equation: SANU =", intercept, "+", slope, "* PANU\n")
```


- Summarize your results as you would do in your master’s thesis report, or as in a scientific article (e.g., What sentence will you write in the article explaining your result?).


 Correlation :

    Spearman’s rank correlation indicated a weak but significant positive association between PANU and SANU (ρ = 0.22, p = 0.002), suggesting that greater shoulder non-use tends to be associated with greater proximal arm non-use.

 Regression :

    However, linear regression analysis showed that SANU did not significantly predict PANU (β = 0.10, R² = 0.009, p = 0.17), indicating that shoulder non-use accounts for less than 1% of the variance in proximal arm non-use.


- What are the limits of your analysis?

    The findings should be interpreted cautiously. While a weak but statistically significant correlation was identified between PANU and SANU, the regression analysis failed to establish a predictive relationship, accounting for less than 1% of the variance. Such limitations may stem from the small sample size, the presence of missing data, and the multifactorial nature of upper-limb non-use, which is likely influenced by additional clinical variables not considered in this model.

# Statistical tests: comparison of medians (or means?)
In this series of exercises, you will explore how to compare two groups of data, using non-parametric tests (or parametric tests… if it makes sense to do so).

## Make clear what is a statistical test, and when to use it.
Below are some questions to guide your analysis. You can answer them in your notebook, with a short sentence for each question.


What is a median? A mean?

    Median: the middle value of ordered data (50% above, 50% below).
    Mean: the arithmetic average of all values.

What is a variance? A standard deviation?

    Variance (σ²): average squared deviation from the mean.
    Standard deviation (σ): square root of variance, shows average spread in original units.

What is a normal distribution?

    A symmetric, bell-shaped distribution defined by mean μ and variance σ².

What is a statistical test?

    A procedure to decide if observed data provide enough evidence against a null hypothesis.

When to use a statistical test?

    When you want to infer about a population parameter from sample data (e.g., mean difference, correlation).

What is a parametric test? A non-parametric test?

    Parametric: assumes data follow a known distribution (e.g., t-test, ANOVA).
    Non-parametric: no distributional assumption, works with ranks (e.g., Mann-Whitney, Wilcoxon).

What are the assumptions of parametric tests?

    Normal distribution (or large n, CLT).
    
    Homogeneity of variance (equal spread between groups).
    
    Independence of observations.

What are the assumptions of non-parametric tests?

    Independence of observations.

    Ordinal or continuous data.

    Similar shapes of distributions if comparing medians.

What is a p-value?

    The probability of obtaining results at least as extreme as observed, assuming the null hypothesis is true.
    
What is the risk of error when using a statistical test?

    Type I error (α): rejecting a true null hypothesis (false positive).
    Type II error (β): failing to reject a false null hypothesis (false negative).

What is the difference between a paired and an unpaired test?

    Paired: compares repeated measures on the same subjects (e.g., before vs after).
    Unpaired: compares independent groups (e.g., treatment vs control).


You can use your favorite LLM, book or web site to answer these questions, but you have to provide at least one reference for each answer (book, article, URL, LLM prompt, etc.).

    Prompt used on CHatGPT-5 plus : "Can you answer these questions in a direct and concise way, if possible by providing references to each question ?"
    
    
 [Download the full reference list](statistics_references.md)
 
 
## Effect of treatment over time

This is a very classical question in clinical or sport research: does a treatment-training have an effect over time?

To answer this question scientifically, measurements must be taken before and after treatment, and possibly later, in order to assess whether the effect is lasting or not.

## The data

Download the file PrePost.csv

```{r load data}
prepost <- read.csv("data/test_data/PrePost.csv", sep = ",", header = TRUE)
head(prepost)
str(prepost)
summary(prepost)


```


This file contains before/after measurements. The treatment is a rehabilitation training for individuals with cardiac conditions.

Before going further, you have to make clear what are the measured variables. What do they measure? What are the units? What are the possible values? What are the expected changes over rehabilitation.

Make a table, with one row per variable, and the following columns:


| Variable | Description | Unit | Possible values | Expected change |
|----------------|-------------------------------|------|----------------|------------------|
| Perf | Cardiac performance measure | Bpm | 40-200 | Increase |
| time |Measurement moment relative to rehabilitation | N/A | Before, After| N/A |


## The analysis
You want to know if the treatment has an effect on one or more of the measured variables.


Does the treatment have an effect?

    Yes, if the “After” values differ significantly from the “Before” values.

What comparison are you going to make?

    Compare the same individuals’ performance “Before” vs “After” rehabilitation.

Which test will you use? Parametric or non-parametric?

    If the differences are approximately normally distributed → use a paired t-test (parametric).
    If not (or small sample size, skewed data) → use the Wilcoxon signed-rank test (non-parametric).

Which graph illustrates the effect of the treatment?


    Boxplot or line plot (paired plot):

    Boxplot → shows median, variability, before vs after.
    Paired line plot → each patient’s trajectory, very clear visually.

What sentence will you write in your thesis to explain your result?


    If significant improvement:

    After rehabilitation, patients showed a significant improvement in cardiac performance, with post-treatment values being higher compared to pre-treatment (p < 0.05).

    If no significant effect:

    No significant change in cardiac performance was observed between the pre- and post-rehabilitation measurements (p > 0.05).

# Testing some stereotypes
Humans have stereotypes, some of them are probably true, some others are probably false (e.g., ref ).

Here, we will test stereotypes about snorers… among others.

## The data
Download the file snore.txt

This file contains anthropometric and qualitative measurements (1 person per line).

## The analysis
Do the data confirm the following stereotypes? Provide a reasoned answer (data, figure, result sentence) for each question.
Are snorers fatter?
Do snorers drink or smoke more?
Are men fatter?
Do women smoke less?
From a more general perspective:
Are there any correlations between variables?

## Epilogue: beyond the scope of this series
Finally, some of you may want to go beyond the scope of this series with new questions, such as:

Can you predict the value of one variable from the others? (linear regression, logistic regression, etc.)
Can you classify individuals based on their variables? (clustering, PCA, etc.)
NOTE: These questions are more advanced, and I don’t want you to address them from a technical standpoint or provide code. But they give you an idea of what you can do with data mining techniques… provided you know why you want to do it. I invite you to think about the perspective these questions open up and, if you feel ready to do so, to write a short paragraph about it.